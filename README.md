# PDF Highlight Viewer

## 概要

PDF ファイルに含まれる**ハイライト**や**指定した色の文字**を検出し、一覧表示とプレビュー、画像・PDF・Excel としてのエクスポートが可能なツールです。
PDF の注釈機能によるハイライトだけでなく、背景色として描画された矩形や、色付きのテキストも検出対象とします。

## 機能

- PDF ファイルを開く機能
- **ハイライト**または**指定色の文字**を自動検出
  - 抽出対象（ハイライト／文字色）を選択可能
- 検出した領域をリストとして一覧表示
- リストで選択した項目を、PDF プレビュー上で赤枠表示
- 選択項目への自動ページ遷移およびスクロール
- プレビュー表示の拡大・縮小機能
- **抽出領域のエクスポート機能**
  - **すべての領域をエクスポート**: 検出されたすべての領域について、それぞれが赤枠で示されたページ全体を、指定した形式で一括保存します。
  - **選択中の領域をエクスポート**: リストで選択している領域について、それが赤枠で示されたページ全体を、指定した形式で 1 ファイルとして保存します。

## 必要なもの

- Python 3.x
- PyMuPDF
- Pillow
- openpyxl

## インストール方法

1. **仮想環境の作成** (推奨)

   ```bash
   python -m venv .venv
   ```

2. **仮想環境のアクティベート**

   - Windows の場合:
     ```bash
     .\.venv\Scripts\activate
     ```
   - macOS / Linux (WSL) の場合:
     ```bash
     source .venv/bin/activate
     ```

3. **必要なライブラリのインストール**
   ```bash
   pip install -r requirements.txt
   ```

## 使い方

1. **アプリケーションの起動**

   以下のコマンドでアプリケーションを起動します。

   ```bash
   # スクリプトとして直接実行する場合
   python PdfHighlightViewer/main.py
   # パッケージとして実行する場合
   python -m PdfHighlightViewer
   ```

2. **PDF の選択と抽出**

   - **(1) PDF ファイルを選択:** 「参照...」ボタン、またはメニューの「ファイル」>「PDF ファイルを選択...」から PDF ファイルを選択します。ファイルパスがテキストエリアに表示されます。
   - **(2) 抽出対象を選択:** 「抽出対象」のラジオボタンで、「ハイライト」または「文字色」のどちらを検出するかを選択します。
   - **(3) 抽出を実行:** 「抽出」ボタン、またはメニューの「ファイル」>「抽出を実行」を押すと、処理が実行されます。検出された領域が左側のリストに一覧表示されます。

3. **抽出領域のエクスポート**

   メニューの「エクスポート」から、以下の操作が可能です。

   - **エクスポート形式の選択**:
     「エクスポート」>「エクスポート形式」から、出力するファイルの形式を選択します。（現在は `画像 (PNG)` `PDF` `Excel` に対応）

   - **すべての領域をエクスポート**:
     「エクスポート」>「すべての領域をエクスポート...」を選択します。

     - **画像(PNG)の場合**: 保存先のフォルダを指定すると、各領域が赤枠で示されたページ画像が、`page-[ページ番号]-[ページ内連番].png` というファイル名で連番保存されます。
     - **PDF の場合**: 保存ファイル名を指定すると、すべての領域を含む 1 つの PDF ファイルが生成されます。このとき、`setting.ini`の`PdfExportMode`の設定によって、PDF の構成方法が変わります（後述）。
     - **Excel の場合**: 保存ファイル名を指定すると、すべての領域が 1 つの Excel ファイルに出力されます。同じページに複数の領域がある場合は、画像やページ番号のセルが結合され、見やすいレイアウトで出力されます。

   - **選択中の領域をエクスポート**:
     左のリストから特定の領域を選択した状態で、「エクスポート」>「選択中の領域をエクスポート...」を選択します。
     ファイル保存ダイアログが表示され、選択中の領域が赤枠で示されたページを、指定した形式のファイル 1 枚として保存できます。

## 設定 (Configuration)

プロジェクトのルートディレクトリにある `setting.ini` ファイルを編集することで、各種設定をカスタマイズできます。

### 色の範囲

検出対象とするハイライトの色と文字の色を、それぞれ指定します。

```ini
[HighlightColor]
# 抽出したいハイライト色のRGB範囲を0-255で指定します
Min_R = 200
Max_R = 255
Min_G = 200
Max_G = 255
Min_B = 0
Max_B = 50

[TextColor]
# 抽出したい文字色のRGB範囲を0-255で指定します
Min_R = 200
Max_R = 255
Min_G = 0
Max_G = 50
Min_B = 0
Max_B = 50
```

- `[HighlightColor]`: ハイライトとして検出する色の RGB 範囲を指定します。
- `[TextColor]`: 文字色として検出する色の RGB 範囲を指定します。
- `Min_R`, `Min_G`, `Min_B`: 検出対象とする色の、赤・緑・青のそれぞれの最小値 (0-255)
- `Max_R`, `Max_G`, `Max_B`: 検出対象とする色の、赤・緑・青のそれぞれの最大値 (0-255)

### エクスポート設定

PDF 形式で「すべての領域をエクスポート」する際の、PDF の構成方法を指定します。

```ini
[Export]
# one_page: ハイライトごとに1ページを作成します
# merge: 1ページ内に存在する複数のハイライトを、1枚のページ上にすべて描画します
PdfExportMode = one_page

# Excelエクスポート時の画像スケール（倍率）。大きいほど高解像度になります。
ExcelImageScale = 2.0
```

設定を変更した後は、アプリケーションを再起動してください。
